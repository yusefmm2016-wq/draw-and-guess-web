<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø²Ø± Ø§Ù„ÙˆØ±Ù‚Ø© - Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            perspective: 1000px;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(100, 200, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        .game-table {
            width: 100%;
            max-width: 100vw;
            margin: 0;
            background: rgba(15, 32, 39, 0.8);
            backdrop-filter: blur(10px);
            padding: 5px;
            min-height: 100vh;
            position: relative;
            z-index: 1;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
        }

        .game-table::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 15px;
            pointer-events: none;
            box-shadow: 0 0 20px rgba(100, 200, 255, 0.2);
        }

        /* Ø±Ø£Ø³ Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .game-header {
            text-align: center;
            color: #ffd700;
            margin-bottom: 4px;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.8), 0 0 20px rgba(100, 200, 255, 0.5);
            position: relative;
            padding: 5px 8px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(100, 200, 255, 0.1) 100%);
            border-radius: 8px;
            border: 1px solid rgba(100, 200, 255, 0.3);
            box-shadow: 0 3px 15px rgba(0,0,0,0.3);
        }

        .game-header h1 {
            font-size: 16px;
            margin: 0 0 3px 0;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .header-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }

        .instructions-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 5px 10px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .instructions-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .instructions-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .instructions-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .controls-divider {
            width: 2px;
            height: 24px;
            background: rgba(255,215,0,0.5);
            margin: 0 4px;
        }

        .music-controls {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .music-btn {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a472a;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(212,175,55,0.5);
            transition: all 0.3s;
        }

        .music-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(212,175,55,0.8);
        }

        .song-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102,126,234,0.4);
            transition: all 0.3s;
        }

        .song-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102,126,234,0.6);
        }

        .song-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-color: #fff;
            box-shadow: 0 4px 15px rgba(245,87,108,0.8);
        }

        .volume-slider {
            width: 60px;
            height: 5px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #d4af37;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: #d4af37;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .instructions-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .instructions-overlay.show {
            display: flex;
        }

        .instructions-card {
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
            padding: 25px;
            border-radius: 20px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid #d4af37;
            box-shadow: 0 10px 40px rgba(212,175,55,0.5);
        }

        .instructions-card h2 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .instructions-card h3 {
            color: #f4d03f;
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .instructions-card p,
        .instructions-card ul {
            color: #ffffff;
            line-height: 1.8;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .instructions-card ul {
            padding-right: 20px;
        }

        .instructions-card li {
            margin-bottom: 8px;
        }

        .close-instructions-btn {
            display: block;
            margin: 20px auto 0;
            padding: 10px 30px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a472a;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-instructions-btn:hover {
            transform: scale(1.05);
        }

        .status-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8px;
            border-radius: 10px;
            margin-bottom: 8px;
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .attempts-bar {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 6px;
            border-radius: 8px;
            margin-bottom: 6px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            box-shadow: 0 3px 12px rgba(240, 147, 251, 0.4);
        }

        /*Ø¨Ø·Ø§Ù‚Ø§Øª */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin: 5px 0;
            padding: 5px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .card {
            position: relative;
            width: 100%;
            height: 110px;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .card {
                height: 90px;
            }
            
            .cards-container {
                gap: 4px;
                padding: 4px;
            }
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
        }

        .card-front {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            border: 3px solid #d4af37;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }

        .card-back {
            background: linear-gradient(135deg, #8b0000 0%, #dc143c 100%);
            transform: rotateY(180deg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
        }

        .card-avatar {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 8px;
        }

        .card-avatar img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            border-radius: 8px;
        }

        .card-front {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 3px solid #667eea;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 5px 5px 8px 5px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.8);
        }

        .card-name {
            font-size: 12px;
            font-weight: bold;
            color: #1a472a;
            margin: 0;
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .card-details {
            font-size: 8px;
            color: #666;
            text-align: center;
            line-height: 1.1;
        }

        .card-badge {
            display: inline-block;
            margin: 1px;
            font-size: 9px;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .control-panel {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 4px;
            border-radius: 8px;
            margin: 3px 0;
            border: 2px solid rgba(255,215,0,0.3);
        }

        .chat-container {
            background: rgba(15, 32, 39, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            padding: 6px;
            margin-bottom: 6px;
            border: 2px solid rgba(100, 200, 255, 0.3);
            box-shadow: 0 5px 20px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 13px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-messages {
            max-height: 140px;
            min-height: 100px;
            overflow-y: auto;
            margin-bottom: 4px;
            padding: 4px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            border: 1px solid rgba(255,215,0,0.2);
        }

        .chat-message {
            margin: 6px 0;
            padding: 6px 10px;
            border-radius: 12px;
            font-size: 11px;
            position: relative;
            max-width: 75%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.my-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: right;
            margin-left: auto;
            margin-right: 0;
            border-bottom-right-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-message.their-message {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            text-align: left;
            margin-right: auto;
            margin-left: 0;
            border-bottom-left-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-message.answer-message {
            background: linear-gradient(135deg, rgba(255,215,0,0.6) 0%, rgba(255,215,0,0.4) 100%);
            color: white;
            text-align: center;
            margin: 8px auto;
            max-width: 90%;
            font-style: italic;
            border: 2px solid rgba(255,215,0,0.8);
            font-weight: bold;
        }

        .message-sender {
            font-weight: bold;
            font-size: 9px;
            margin-bottom: 2px;
            opacity: 0.95;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .message-content {
            line-height: 1.4;
            font-size: 11px;
        }

        .chat-input-container {
            display: flex;
            gap: 5px;
        }

        .chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 14px;
            transition: all 0.3s;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255,255,255,0.15);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }

        .chat-send-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }

        .chat-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.6);
        }

        .guess-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .guess-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(240, 147, 251, 0.6);
        }

        .guess-btn:active {
            transform: translateY(0);
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ÙØ§Ø¦Ø² */
        .winner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .winner-overlay.show {
            display: flex;
        }

        .winner-card {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            animation: bounceIn 0.8s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .winner-emoji {
            font-size: 60px;
            margin-bottom: 10px;
        }

        .winner-text {
            font-size: 24px;
            font-weight: bold;
            color: #1a472a;
        }

        /* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ© */
        .secret-selection {
            background: rgba(255,215,0,0.2);
            padding: 10px;
            border-radius: 15px;
            border: 2px dashed #ffd700;
        }

        .secret-selection h2 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 10px;
            font-size: 18px;
        }

        /* Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… */
        .name-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .name-overlay.show {
            display: flex;
        }

        .name-card {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            border: 3px solid rgba(100, 200, 255, 0.5);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8), 0 0 30px rgba(100, 200, 255, 0.3);
            max-width: 450px;
            width: 90%;
            backdrop-filter: blur(10px);
        }

        .name-card .game-title {
            background: linear-gradient(135deg, #ffd700, #ffed4e, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255,215,0,0.6);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .name-card h2 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 22px;
        }

        .name-card p {
            color: #ffffff;
            margin-bottom: 25px;
            font-size: 16px;
            line-height: 1.6;
        }

        .player-name-input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(100, 200, 255, 0.5);
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 18px;
            text-align: center;
            margin-bottom: 25px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .player-name-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .player-name-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255,255,255,0.15);
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.5);
            transform: scale(1.02);
        }

        .confirm-name-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .confirm-name-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.7);
        }

        .confirm-name-btn:active {
            transform: translateY(-1px);
        }

        .avatar-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid rgba(100, 200, 255, 0.3);
            transition: all 0.3s;
            object-fit: cover;
            box-shadow: 0 3px 15px rgba(0,0,0,0.3);
        }

        .avatar-option:hover {
            transform: scale(1.1);
            border-color: rgba(102, 126, 234, 0.6);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .avatar-option.selected {
            border-color: #667eea;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.8), 0 0 50px rgba(102, 126, 234, 0.4);
            transform: scale(1.15);
        }

        .chat-message-with-avatar {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            margin: 8px 0;
            width: 100%;
            flex-direction: row-reverse; /* Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
        }

        .chat-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255,215,0,0.4);
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .chat-message-content {
            flex: 1;
            min-width: 0;
            max-width: calc(100% - 51px);
            text-align: right; /* Ø§Ù„Ù†Øµ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
        }

        /* Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© */
        .card-display-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2500;
        }

        .card-display-overlay.show {
            display: flex;
        }

        .card-display-container {
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 3px solid #d4af37;
            box-shadow: 0 10px 40px rgba(212,175,55,0.5);
            max-width: 90%;
            animation: bounceIn 0.6s;
        }

        .card-display-container h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .large-card-display {
            width: 280px;
            height: 350px;
            margin: 0 auto 25px;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            border: 4px solid #d4af37;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(212,175,55,0.6);
        }

        .large-card-display img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .close-card-display-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-card-display-btn:hover {
            transform: scale(1.03);
        }

        /*Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø§Ù„Ù…ØµØºØ±Ø© */
        .my-secret-card-container {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.2) 100%);
            backdrop-filter: blur(10px);
            padding: 6px;
            border-radius: 12px;
            margin-bottom: 6px;
            border: 2px solid rgba(100, 200, 255, 0.5);
            text-align: center;
            box-shadow: 0 3px 15px rgba(0,0,0,0.3);
        }

        .my-secret-label {
            color: #64c8ff;
            font-weight: bold;
            font-size: 11px;
            margin-bottom: 4px;
            text-shadow: 0 2px 10px rgba(100, 200, 255, 0.8);
        }

        .my-secret-card {
            width: 55px;
            height: 70px;
            margin: 0 auto;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            border: 2px solid #d4af37;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(212,175,55,0.5);
        }

        .my-secret-card img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="game-table">
        <div class="game-header">
            <h1 style="background: linear-gradient(135deg, #ffd700, #ffed4e, #d4af37); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 20px rgba(255,215,0,0.5);">âœ¨ Ø·ÙˆÙŠÙ‚ âœ¨</h1>
            <div class="header-controls">
                <button class="instructions-btn" onclick="showInstructions()">ğŸ“– Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</button>
            </div>
        </div>

        <div class="status-bar" id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <div class="attempts-bar" id="attemptsBar" style="display: none;">
            ğŸ¯ ÙØ±Øµ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="attemptsCount">2</span>
        </div>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ© -->
        <div id="secret-selection" style="display: none;" class="secret-selection">
            <h2>âœ¨ Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ© âœ¨</h2>
            <div class="cards-container" id="secret-cards"></div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
        <div id="game-area" style="display: none;">
            <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© -->
            <div class="my-secret-card-container" id="mySecretCardContainer" style="display: none;">
                <div class="my-secret-label">ğŸ¯ Ø¨Ø·Ø§Ù‚ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ©:</div>
                <div class="my-secret-card" id="mySecretCard"></div>
            </div>

            <div class="cards-container" id="cards-grid"></div>

            <div class="control-panel">
                <button class="guess-btn" onclick="enableGuessMode()" style="margin-bottom: 8px; padding: 8px; font-size: 14px;">
                    ğŸ¯ Ø®Ù…Ù‘Ù† Ø§Ù„Ø´Ø®ØµÙŠØ©
                </button>
                
                <div class="chat-container">
                    <div class="chat-header">ğŸ’¬ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø£Ø¬ÙˆØ¨Ø©</div>
                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px; font-size: 12px;">
                            ğŸ“ Ø§Ø¨Ø¯Ø£ Ø¨Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„ØªÙƒ Ù‡Ù†Ø§...
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§ ÙˆØ§Ø¶ØºØ· Enter..." />
                        <button class="chat-send-btn" onclick="sendChatQuestion()">ğŸ“¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="winner-overlay" id="winnerOverlay">
        <div class="winner-card">
            <div class="winner-emoji" id="winnerEmoji">ğŸ†</div>
            <div class="winner-text" id="winnerText"></div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… -->
    <div class="name-overlay" id="nameOverlay">
        <div class="name-card">
            <div class="game-title">âœ¨ Ø·ÙˆÙŠÙ‚ âœ¨</div>
            <h2>ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨!</h2>
            <p>ğŸ® Ø§Ø³ØªØ¹Ø¯ Ù„Ø®ÙˆØ¶ ØªØ­Ø¯ÙŠ Ù…Ø«ÙŠØ± ÙÙŠ Ù„Ø¹Ø¨Ø© Ø·ÙˆÙŠÙ‚</p>

            <!-- Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
            <div style="text-align: center; margin-bottom: 20px;">
                <div id="userPhotoContainer" style="width: 120px; height: 120px; margin: 0 auto; border-radius: 50%; border: 4px solid rgba(100, 200, 255, 0.5); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);">
                    <span style="font-size: 60px; color: white;">ğŸ‘¤</span>
                </div>
            </div>

            <input type="text" id="playerNameInput" class="player-name-input" placeholder="âœï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." maxlength="20">
            <button class="confirm-name-btn" onclick="confirmPlayerName()">âœ… Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© -->
    <div class="card-display-overlay" id="cardDisplayOverlay">
        <div class="card-display-container">
            <h2>âœ¨ Ø¨Ø·Ø§Ù‚ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ© âœ¨</h2>
            <div class="large-card-display" id="largeCardDisplay"></div>
            <button class="close-card-display-btn" onclick="closeCardDisplay()">âœ… Ø­ÙØ¸ ÙˆØ§Ø³ØªÙ…Ø±Ø§Ø±</button>
        </div>
    </div>

    <div class="instructions-overlay" id="instructionsOverlay">
        <div class="instructions-card">
            <h2>ğŸ“– ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ø¹Ø¨Ø© Ø­Ø²Ø± Ø§Ù„ÙˆØ±Ù‚Ø©</h2>

            <h3>ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©:</h3>
            <p>Ø­Ø²Ø± Ø´Ø®ØµÙŠØ© Ø§Ù„Ø®ØµÙ… Ù‚Ø¨Ù„ Ø£Ù† ÙŠØ­Ø²Ø± Ø´Ø®ØµÙŠØªÙƒ!</p>

            <h3>ğŸ“ ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨:</h3>
            <ul>
                <li>ğŸ”¹ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ®ØªØ§Ø± Ø´Ø®ØµÙŠØ© Ø³Ø±ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</li>
                <li>ğŸ”¹ Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨ØŒ ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙ… (Ù…Ø«Ù„: Ù‡Ù„ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø£Ù†Ø«Ù‰ØŸ Ù‡Ù„ ØªØ±ØªØ¯ÙŠ Ù†Ø¸Ø§Ø±Ø©ØŸ)</li>
                <li>ğŸ”¹ Ø§Ù„Ø®ØµÙ… ÙŠØ¬ÙŠØ¨ Ø¨Ù€ "Ù†Ø¹Ù…" Ø£Ùˆ "Ù„Ø§" ÙÙ‚Ø·</li>
                <li>ğŸ”¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØªØ·Ø§Ø¨Ù‚ (Ø§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§ Ù„Ù‚Ù„Ø¨Ù‡Ø§)</li>
                <li>ğŸ”¹ Ø¹Ù†Ø¯Ù…Ø§ ØªØ¹Ø±Ù Ø§Ù„Ø´Ø®ØµÙŠØ©ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø®Ù…Ù‘Ù† Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©" ÙˆØ§Ø®ØªØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</li>
            </ul>

            <h3>ğŸ’¡ Ù†ØµØ§Ø¦Ø­:</h3>
            <ul>
                <li>â­ Ø§Ø³Ø£Ù„ Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠØ© ØªØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</li>
                <li>â­ Ø±Ø§Ù‚Ø¨ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø®ØµÙ…Ùƒ Ø¨Ø¹Ù†Ø§ÙŠØ©</li>
                <li>â­ Ù„Ø§ ØªØ®Ù…Ù‘Ù† Ù…Ø¨ÙƒØ±Ø§Ù‹ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©</li>
            </ul>

            <h3>ğŸ® Ø§Ù„ØªØ­ÙƒÙ…:</h3>
            <ul>
                <li>ğŸ’¬ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©: Ø§ÙƒØªØ¨ Ø£Ø³Ø¦Ù„ØªÙƒ Ù‡Ù†Ø§ (Ù…Ø«Ù„: Ø£Ù†Ø«Ù‰ØŸ Ù†Ø¸Ø§Ø±Ø©ØŸ Ø´Ø¹Ø± Ø£Ø´Ù‚Ø±ØŸ)</li>
                <li>ğŸ´ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: Ø§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§ Ù„Ø§Ø³ØªØ¨Ø¹Ø§Ø¯Ù‡Ø§ ÙˆÙ‚Ù„Ø¨Ù‡Ø§</li>
                <li>ğŸ¯ Ø²Ø± Ø§Ù„ØªØ®Ù…ÙŠÙ†: Ø§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡ Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø§Ù‹ Ù„Ù„ØªØ®Ù…ÙŠÙ† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</li>
            </ul>

            <h3>ğŸ† Ø§Ù„ÙÙˆØ²:</h3>
            <p>Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ®Ù…Ù† Ø´Ø®ØµÙŠØ© Ø§Ù„Ø®ØµÙ… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙŠÙÙˆØ²!</p>

            <button class="close-instructions-btn" onclick="hideInstructions()">âœ… ÙÙ‡Ù…ØªØŒ Ù„Ù†Ø¨Ø¯Ø£!</button>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session');
        const playerId = parseInt(urlParams.get('player'));
        let gameState = null;
        let guessMode = false;
        let isSpectator = playerId === 0;

        let messageCount = 0;
        let playerName = null; // Ø¹Ø¯Ù… Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù… - Ø³ÙŠÙØ·Ù„Ø¨ ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©
        let playerAvatar = null; // ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
        let mySecretCardId = null;

        // Ø¬Ù„Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
        let telegramUserPhoto = null;
        let photoLoadPromise = null;
        
        async function loadUserPhoto() {
            const photoContainer = document.getElementById('userPhotoContainer');
            
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const user = tg.initDataUnsafe.user;
                    
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    if (!playerName && user.first_name) {
                        playerName = user.first_name;
                        document.getElementById('playerNameInput').value = user.first_name;
                    }
                    
                    // Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
                    if (user.id) {
                        try {
                            console.log('Fetching photo for user:', user.id);
                            const response = await fetch(`/api/get_user_photo/${user.id}`);
                            const data = await response.json();
                            
                            if (data.photo_url && data.photo_url !== null && data.photo_url.startsWith('data:image')) {
                                telegramUserPhoto = data.photo_url;
                                playerAvatar = data.photo_url;
                                
                                // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø³Ù…
                                if (photoContainer) {
                                    photoContainer.innerHTML = `<img src="${data.photo_url}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                                }
                                
                                console.log('Photo loaded successfully');
                            } else {
                                console.log('No photo available from Telegram');
                            }
                        } catch (err) {
                            console.error('Error fetching photo:', err);
                        }
                    }
                }
            } else {
                console.log('Telegram WebApp not available');
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
        photoLoadPromise = loadUserPhoto();
        
        

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙˆØ§Øª
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            switch(type) {
                case 'flip': // ØµÙˆØª Ù‚Ù„Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;

                case 'correct': // ØµÙˆØª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;

                case 'wrong': // ØµÙˆØª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
                    oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;

                case 'win': // ØµÙˆØª Ø§Ù„ÙÙˆØ²
                    const frequencies = [523.25, 659.25, 783.99, 1046.50]; // C-E-G-C
                    frequencies.forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.15);
                        gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.15);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.3);
                        osc.start(audioContext.currentTime + i * 0.15);
                        osc.stop(audioContext.currentTime + i * 0.15 + 0.3);
                    });
                    return; // Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ù„Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ

                case 'lose': // ØµÙˆØª Ø§Ù„Ø®Ø³Ø§Ø±Ø©
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.5);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;

                case 'message': // ØµÙˆØª ÙˆØµÙˆÙ„ Ø±Ø³Ø§Ù„Ø©
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.05);
                    break;
            }
        }

        function addChatMessage(text, type, senderName = null, senderAvatar = null) {
            const chatMessages = document.getElementById('chatMessages');

            // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© "Ø§Ø¨Ø¯Ø£ Ø¨Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„ØªÙƒ" Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø©
            if (messageCount === 0) {
                chatMessages.innerHTML = '';
            }
            messageCount++;

            if (type === 'answer-message') {
                // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©
                const messageEl = document.createElement('div');
                messageEl.className = `chat-message ${type}`;
                const contentEl = document.createElement('div');
                contentEl.className = 'message-content';
                contentEl.textContent = text;
                messageEl.appendChild(contentEl);
                chatMessages.appendChild(messageEl);
            } else {
                // Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ© Ù…Ø¹ ØµÙˆØ±Ø© - Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†
                const containerEl = document.createElement('div');
                containerEl.className = 'chat-message-with-avatar';
                containerEl.style.alignItems = 'flex-end';
                containerEl.style.gap = '8px';
                containerEl.style.marginBottom = '8px';

                // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø³Ù„ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (senderAvatar && senderAvatar.trim() !== '') {
                    const avatarEl = document.createElement('img');
                    avatarEl.src = senderAvatar;
                    avatarEl.className = 'chat-avatar';
                    avatarEl.alt = senderName || 'Avatar';
                    containerEl.appendChild(avatarEl);
                } else {
                    // Ø¹Ø±Ø¶ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©
                    const iconEl = document.createElement('div');
                    iconEl.className = 'chat-avatar';
                    iconEl.style.display = 'flex';
                    iconEl.style.alignItems = 'center';
                    iconEl.style.justifyContent = 'center';
                    iconEl.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    iconEl.innerHTML = '<span style="font-size: 18px;">ğŸ‘¤</span>';
                    containerEl.appendChild(iconEl);
                }

                const messageContentEl = document.createElement('div');
                messageContentEl.className = 'chat-message-content';

                const messageEl = document.createElement('div');
                messageEl.className = `chat-message ${type}`;

                if (senderName) {
                    const senderEl = document.createElement('div');
                    senderEl.className = 'message-sender';
                    senderEl.textContent = senderName;
                    messageEl.appendChild(senderEl);
                }

                const contentEl = document.createElement('div');
                contentEl.className = 'message-content';
                contentEl.textContent = text;
                messageEl.appendChild(contentEl);

                messageContentEl.appendChild(messageEl);
                containerEl.appendChild(messageContentEl);
                chatMessages.appendChild(containerEl);
            }

            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ø³ÙÙ„
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendChatQuestion() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();

            if (!text || !gameState) {
                return;
            }

            input.value = '';

            // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‚Ø¯ Ø­ÙÙ…Ù„Øª Ø¨Ø¹Ø¯
            if (photoLoadPromise) {
                await photoLoadPromise;
            }

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            const avatarToSend = playerAvatar || telegramUserPhoto;

            console.log('Sending message with avatar:', avatarToSend);

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³ÙŠØ±ÙØ± (Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯ÙˆØ±)
            await fetch('/api/send_message', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    session_id: sessionId,
                    player_id: playerId,
                    message: text,
                    avatar: avatarToSend
                })
            });

            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            loadGameState();
        }

        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('chatInput');
            if (input) {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatQuestion();
                    }
                });
            }

            const nameInput = document.getElementById('playerNameInput');
            if (nameInput) {
                nameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        confirmPlayerName();
                    }
                });
            }
        });

        async function processTextQuestion(text) {
            text = text.toLowerCase();

            let attribute, value, question;

            if (text.includes('Ø£Ù†Ø«Ù‰') || text.includes('Ø¨Ù†Øª') || text.includes('Ø§Ù…Ø±Ø£Ø©')) {
                attribute = 'gender';
                value = 'Ø£Ù†Ø«Ù‰';
                question = 'Ù‡Ù„ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø£Ù†Ø«Ù‰ØŸ';
            } else if (text.includes('Ø°ÙƒØ±') || text.includes('Ø±Ø¬Ù„') || text.includes('ÙˆÙ„Ø¯')) {
                attribute = 'gender';
                value = 'Ø°ÙƒØ±';
                question = 'Ù‡Ù„ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø°ÙƒØ±ØŸ';
            } else if (text.includes('Ù†Ø¸Ø§Ø±Ø©') || text.includes('Ù†Ø¶Ø§Ø±Ø©')) {
                attribute = 'glasses';
                value = true;
                question = 'Ù‡Ù„ ØªØ±ØªØ¯ÙŠ Ù†Ø¸Ø§Ø±Ø©ØŸ';
            } else if (text.includes('Ø£Ø´Ù‚Ø±') || text.includes('Ø§Ø´Ù‚Ø±')) {
                attribute = 'hair';
                value = 'Ø£Ø´Ù‚Ø±';
                question = 'Ù‡Ù„ Ø§Ù„Ø´Ø¹Ø± Ø£Ø´Ù‚Ø±ØŸ';
            } else if (text.includes('Ø£Ø³ÙˆØ¯') || text.includes('Ø§Ø³ÙˆØ¯')) {
                attribute = 'hair';
                value = 'Ø£Ø³ÙˆØ¯';
                question = 'Ù‡Ù„ Ø§Ù„Ø´Ø¹Ø± Ø£Ø³ÙˆØ¯ØŸ';
            } else if (text.includes('Ø¨Ù†ÙŠ')) {
                attribute = 'hair';
                value = 'Ø¨Ù†ÙŠ';
                question = 'Ù‡Ù„ Ø§Ù„Ø´Ø¹Ø± Ø¨Ù†ÙŠØŸ';
            } else if (text.includes('Ù‚Ø¨Ø¹Ø©') || text.includes('Ø·Ø§Ù‚ÙŠØ©')) {
                attribute = 'hat';
                value = true;
                question = 'Ù‡Ù„ ØªØ±ØªØ¯ÙŠ Ù‚Ø¨Ø¹Ø©ØŸ';
            } else {
                // Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ… - Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¡
                return;
            }

            const response = await fetch('/api/ask_question', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    session_id: sessionId,
                    player_id: playerId,
                    question: question,
                    attribute: attribute,
                    value: value
                })
            });
            const data = await response.json();

            const answerEmoji = data.answer === 'Ù†Ø¹Ù…' ? 'âœ…' : 'âŒ';
            addChatMessage(`${answerEmoji} Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ${data.answer}`, 'answer-message');
            loadGameState();
        }

        async function loadGameState() {
            const response = await fetch(`/api/game/${sessionId}/${playerId}`);
            gameState = await response.json();
            updateUI();
        }

        function getCharacterImage(character) {
            return character.image || 'https://via.placeholder.com/60';
        }

        function updateUI() {
            const statusEl = document.getElementById('status');
            const chatInput = document.getElementById('chatInput');
            const guessBtn = document.querySelector('.guess-btn');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙ‚Ø·
            if (!isSpectator && !gameState.is_spectator && !playerName) {
                document.getElementById('nameOverlay').classList.add('show');
            }

            // ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
            if (isSpectator || gameState.is_spectator) {
                document.getElementById('secret-selection').style.display = 'none';
                document.getElementById('game-area').style.display = 'block';

                const players = gameState.players || [];
                const playersText = players.length > 0 ? `\nğŸ‘¥ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: ${players.join(' vs ')}` : '';

                if (gameState.status === 'choosing_secret') {
                    statusEl.textContent = 'â³ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ÙŠØ®ØªØ§Ø±ÙˆÙ† Ø´Ø®ØµÙŠØ§ØªÙ‡Ù…...' + playersText;
                } else if (gameState.status === 'playing') {
                    statusEl.textContent = 'ğŸ‘ï¸ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© - ØªØ§Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø©' + playersText;
                } else if (gameState.status === 'finished') {
                    statusEl.textContent = 'ğŸ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!' + playersText;
                }

                renderCards();
                renderHistory();

                // ØªØ¹Ø·ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†
                if (guessBtn) guessBtn.disabled = true;
                if (chatInput) chatInput.disabled = true;
                return;
            }

            if (gameState.status === 'choosing_secret') {
                if (!gameState.secret_card) {
                    document.getElementById('secret-selection').style.display = 'block';
                    document.getElementById('game-area').style.display = 'none';
                    statusEl.textContent = 'âœ¨ Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª';
                    renderSecretCards();
                } else {
                    statusEl.textContent = 'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®ØµÙ…...';
                }
            } else if (gameState.status === 'playing') {
                document.getElementById('secret-selection').style.display = 'none';
                document.getElementById('game-area').style.display = 'block';

                statusEl.textContent = 'ğŸ® Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ø±ÙŠØ© - ØªÙÙ‚ÙˆØ§ Ø¹Ù„Ù‰ Ù…Ù† ÙŠØ¨Ø¯Ø£!';
                statusEl.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                statusEl.style.color = 'white';
                
                // ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø¦Ù…Ø§Ù‹
                if (guessBtn) guessBtn.disabled = false;
                if (chatInput) {
                    chatInput.disabled = false;
                    chatInput.placeholder = 'Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...';
                }

                // Ø¹Ø±Ø¶ ÙØ±Øµ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
                const attemptsBar = document.getElementById('attemptsBar');
                const attemptsCount = document.getElementById('attemptsCount');
                const remainingAttempts = 2 - (gameState.guess_attempts || 0);
                
                if (attemptsBar && attemptsCount) {
                    attemptsBar.style.display = 'block';
                    attemptsCount.textContent = remainingAttempts;
                    
                    if (remainingAttempts <= 0) {
                        attemptsBar.style.background = 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)';
                        attemptsCount.textContent = '0 - Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±Øµ Ù…ØªØ¨Ù‚ÙŠØ©!';
                    } else if (remainingAttempts === 1) {
                        attemptsBar.style.background = 'linear-gradient(135deg, #ff9800 0%, #f57c00 100%)';
                    }
                }

                renderCards();
                loadChatHistory();
            } else if (gameState.status === 'finished') {
                showWinner();
            }
        }

        function renderSecretCards() {
            const grid = document.getElementById('secret-cards');
            grid.innerHTML = '';

            gameState.cards.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.innerHTML = `
                    <div class="card-front">
                        <div class="card-avatar"><img src="${getCharacterImage(card)}" alt="${card.name}"></div>
                        <div class="card-name">${card.name}</div>
                    </div>
                    <div class="card-back">âŒ</div>
                `;
                cardEl.onclick = () => chooseSecret(card.id);
                grid.appendChild(cardEl);
            });
        }

        async function confirmPlayerName() {
            const nameInput = document.getElementById('playerNameInput');
            const name = nameInput.value.trim();

            if (!name) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ!');
                return;
            }

            playerName = name;
            
            // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
            if (photoLoadPromise) {
                await photoLoadPromise;
            }
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            playerAvatar = telegramUserPhoto;

            console.log('Setting player name with avatar:', playerAvatar);

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø³ÙŠØ±ÙØ±
            await fetch('/api/set_player_name', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    session_id: sessionId,
                    player_id: playerId,
                    name: name,
                    avatar: playerAvatar
                })
            });

            document.getElementById('nameOverlay').classList.remove('show');
            playSound('correct');
        }

        

        async function chooseSecret(cardId) {
            playSound('correct');
            mySecretCardId = cardId;

            await fetch('/api/choose_secret', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({session_id: sessionId, player_id: playerId, card_id: cardId})
            });

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±
            const selectedCard = gameState.cards.find(c => c.id === cardId);
            if (selectedCard) {
                const largeCardDisplay = document.getElementById('largeCardDisplay');
                largeCardDisplay.innerHTML = `
                    <img src="${getCharacterImage(selectedCard)}" alt="${selectedCard.name}">
                    <div style="position: absolute; bottom: 15px; width: 100%; text-align: center; background: linear-gradient(135deg, #d4af37, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 24px; font-weight: bold;">${selectedCard.name}</div>
                `;
                document.getElementById('cardDisplayOverlay').classList.add('show');
            }

            loadGameState();
        }

        function closeCardDisplay() {
            document.getElementById('cardDisplayOverlay').classList.remove('show');
            playSound('correct');
        }

        function renderCards() {
            const grid = document.getElementById('cards-grid');
            grid.innerHTML = '';

            gameState.cards.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.setAttribute('data-card-id', card.id);
                
                if (gameState.eliminated.includes(card.id)) {
                    cardEl.classList.add('flipped');
                }

                cardEl.innerHTML = `
                    <div class="card-front">
                        <div class="card-avatar"><img src="${getCharacterImage(card)}" alt="${card.name}"></div>
                        <div class="card-name">${card.name}</div>
                    </div>
                    <div class="card-back">âŒ</div>
                `;

                if (!isSpectator && !gameState.is_spectator) {
                    if (guessMode && !gameState.eliminated.includes(card.id)) {
                        cardEl.onclick = () => makeGuess(card.id);
                    } else {
                        // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Ù…Ù‚Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ±Ø§Ø¬Ø¹
                        cardEl.onclick = () => eliminateCard(card.id);
                    }
                }

                grid.appendChild(cardEl);
            });

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø§Ù„Ù…ØµØºØ±Ø©
            if (gameState.secret_card && !isSpectator && !gameState.is_spectator) {
                const secretCard = gameState.cards.find(c => c.id === gameState.secret_card);
                if (secretCard) {
                    const container = document.getElementById('mySecretCardContainer');
                    const cardDisplay = document.getElementById('mySecretCard');
                    cardDisplay.innerHTML = `<img src="${getCharacterImage(secretCard)}" alt="${secretCard.name}">`;
                    container.style.display = 'block';
                }
            }
        }

        async function askQuestion(attribute, value, question) {
            if (!gameState.is_turn) return;

            const response = await fetch('/api/ask_question', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    session_id: sessionId,
                    player_id: playerId,
                    question: question,
                    attribute: attribute,
                    value: value
                })
            });
            const data = await response.json();

            const answerEmoji = data.answer === 'Ù†Ø¹Ù…' ? 'âœ…' : 'âŒ';
            alert(`${answerEmoji} Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ${data.answer}`);
            loadGameState();
        }

        async function eliminateCard(cardId) {
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù‚Ù„Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
            playSound('flip');

            // Toggle: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø³ØªØ¨Ø¹Ø¯Ø© ØªÙÙ„ØºÙ‰ØŒ ÙˆØ¥Ù† Ù„Ù… ØªÙƒÙ† ØªÙØ³ØªØ¨Ø¹Ø¯
            const response = await fetch('/api/eliminate_card', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({session_id: sessionId, player_id: playerId, card_id: cardId})
            });
            
            const data = await response.json();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
            const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
            if (cardElement) {
                if (data.action === 'added') {
                    cardElement.classList.add('flipped');
                } else if (data.action === 'removed') {
                    cardElement.classList.remove('flipped');
                }
            }
            
            loadGameState();
        }

        function enableGuessMode() {
            guessMode = true;
            alert('ğŸ¯ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙŠ ØªØ¹ØªÙ‚Ø¯ Ø£Ù†Ù‡Ø§ Ø§Ù„ØµØ­ÙŠØ­Ø©!');
            renderCards();
        }

        async function makeGuess(cardId) {
            const response = await fetch('/api/guess', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({session_id: sessionId, player_id: playerId, card_id: cardId})
            });
            const data = await response.json();

            if (data.correct) {
                playSound('win');
                alert('ğŸ‰ ØªØ®Ù…ÙŠÙ† ØµØ­ÙŠØ­! Ù„Ù‚Ø¯ ÙØ²Øª!');
            } else {
                playSound('wrong');
                const remainingAttempts = 2 - data.attempts;
                
                if (data.game_over) {
                    if (data.no_winner) {
                        // Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ§Ø¦Ø² - ÙƒÙ„Ø§Ù‡Ù…Ø§ Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙ‡Ù…Ø§
                        playSound('lose');
                        alert('âŒ ØªØ®Ù…ÙŠÙ† Ø®Ø§Ø·Ø¦!\n\nğŸ˜” Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„ÙØ±ØµØªÙŠÙ†!\n\nğŸ¤ Ù„Ù… ÙŠØ­Ø²Ø± Ø£Ø­Ø¯ - Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯ÙˆÙ† ÙØ§Ø¦Ø²');
                    } else {
                        // Ø§Ù„Ø®ØµÙ… ÙØ§Ø² (ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠØ­Ø¯Ø« Ù‡Ø°Ø§ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
                        playSound('lose');
                        alert('âŒ ØªØ®Ù…ÙŠÙ† Ø®Ø§Ø·Ø¦!\n\nğŸ˜” Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„ÙØ±ØµØªÙŠÙ† ÙˆØ®Ø³Ø±Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!');
                    }
                } else {
                    if (data.waiting_for_opponent) {
                        // Ø§Ø³ØªØ®Ø¯Ù…Øª Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø®ØµÙ…
                        alert(`âŒ ØªØ®Ù…ÙŠÙ† Ø®Ø§Ø·Ø¦!\n\nğŸ˜” Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„ÙØ±ØµØªÙŠÙ†!\n\nâ³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø®ØµÙ… Ù„Ø¥ÙƒÙ…Ø§Ù„ Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙ‡...`);
                    } else {
                        alert(`âŒ ØªØ®Ù…ÙŠÙ† Ø®Ø§Ø·Ø¦!\n\nğŸ¯ Ù„Ø¯ÙŠÙƒ ${remainingAttempts} ÙØ±ØµØ© Ù…ØªØ¨Ù‚ÙŠØ©`);
                    }
                }
            }
            guessMode = false;
            loadGameState();
        }

        let lastHistoryLength = 0;
        let lastChatLength = 0;

        function loadChatHistory() {
            const chatMessages = document.getElementById('chatMessages');

            // ØªØ­Ù…ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø£Ø¬ÙˆØ¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            if (gameState.history.length > lastHistoryLength) {
                for (let i = lastHistoryLength; i < gameState.history.length; i++) {
                    const item = gameState.history[i];
                    const emoji = item.answer === 'Ù†Ø¹Ù…' ? 'âœ…' : 'âŒ';
                    const playerName = item.player_name || `Ù„Ø§Ø¹Ø¨ ${item.player}`;
                    const messageType = item.player === playerId ? 'my-message' : 'their-message';
                    const senderName = item.player === playerId ? 'Ø£Ù†Øª' : playerName;
                    const senderAvatar = item.player_avatar || null;

                    addChatMessage(item.question, messageType, senderName, senderAvatar);
                    addChatMessage(`${emoji} Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ${item.answer}`, 'answer-message');

                    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
                    if (item.answer === 'Ù†Ø¹Ù…') {
                        playSound('correct');
                    } else {
                        playSound('wrong');
                    }
                }
                lastHistoryLength = gameState.history.length;
            }

            // ØªØ­Ù…ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const chatMessagesList = gameState.chat_messages || [];
            if (chatMessagesList.length > lastChatLength) {
                for (let i = lastChatLength; i < chatMessagesList.length; i++) {
                    const item = chatMessagesList[i];
                    const playerName = item.player_name || `Ù„Ø§Ø¹Ø¨ ${item.player}`;
                    const messageType = item.player === playerId ? 'my-message' : 'their-message';
                    const senderName = item.player === playerId ? 'Ø£Ù†Øª' : playerName;
                    const senderAvatar = item.player_avatar || null;

                    addChatMessage(item.message, messageType, senderName, senderAvatar);

                    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®ØµÙ… ÙÙ‚Ø·
                    if (item.player !== playerId) {
                        playSound('message');
                    }
                }
                lastChatLength = chatMessagesList.length;
            }
        }

        function showWinner() {
            const overlay = document.getElementById('winnerOverlay');
            const emoji = document.getElementById('winnerEmoji');
            const text = document.getElementById('winnerText');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙØ§Ø¦Ø²
            if (gameState.winner === null || gameState.winner === undefined) {
                emoji.textContent = 'ğŸ¤';
                text.textContent = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯ÙˆÙ† ÙØ§Ø¦Ø²!\n\nÙ„Ù… ÙŠØ­Ø²Ø± Ø£Ø­Ø¯ Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©';
                playSound('lose'); // ØµÙˆØª Ø§Ù„Ø®Ø³Ø§Ø±Ø©
            } else if (gameState.winner === playerId) {
                emoji.textContent = 'ğŸ†';
                text.textContent = 'Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ ÙØ²Øª!';
                playSound('win'); // ØµÙˆØª Ø§Ù„ÙÙˆØ²
            } else {
                emoji.textContent = 'ğŸ˜”';
                text.textContent = 'Ø®Ø³Ø±Øª! Ø­Ø¸ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©';
                playSound('lose'); // ØµÙˆØª Ø§Ù„Ø®Ø³Ø§Ø±Ø©
            }

            overlay.classList.add('show');
        }

        function showInstructions() {
            const overlay = document.getElementById('instructionsOverlay');
            overlay.classList.add('show');
        }

        function hideInstructions() {
            const overlay = document.getElementById('instructionsOverlay');
            overlay.classList.remove('show');
        }

        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
        const bgMusic = document.getElementById('backgroundMusic');
        const bgMusic2 = document.getElementById('backgroundMusic2');
        const musicToggle = document.getElementById('musicToggle');
        const volumeSlider = document.getElementById('volumeSlider');
        let isMusicPlaying = false;
        let currentSong = 1; // Ø§Ù„Ø£ØºÙ†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            // No music initialization needed as music controls are removed.
        });

        function toggleMusic() {
            // This function is no longer needed as music controls are removed.
        }

        function switchToSong(direction) {
            // This function is no longer needed as music controls are removed.
        }

        function changeVolume(value) {
            // This function is no longer needed as music controls are removed.
        }

        setInterval(loadGameState, 2000);
        loadGameState();
    </script>
</body>
</html>